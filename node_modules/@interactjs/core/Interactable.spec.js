import d from '@interactjs/_dev/test/domator';
import test from '@interactjs/_dev/test/test';
import * as helpers from './tests/_helpers';
test('Interactable copies and extends defaults', (t) => {
    const scope = helpers.mockScope();
    const { defaults } = scope;
    scope.actions.methodDict = { test: 'testize' };
    scope.Interactable.prototype.testize = function (options) {
        this.setPerAction('test', options);
    };
    defaults.actions.test = {
        fromDefault: { a: 1, b: 2 },
        specified: { c: 1, d: 2 },
    };
    const specified = { specified: 'parent' };
    const div = d('div');
    const interactable = scope.interactables.new(div, { test: specified });
    t.deepEqual(interactable.options.test.specified, specified.specified, 'specified options are properly set');
    t.deepEqual(interactable.options.test.fromDefault, defaults.actions.test.fromDefault, 'default options are properly set');
    t.notEqual(interactable.options.test.fromDefault, defaults.actions.test.fromDefault, 'defaults are not aliased');
    defaults.actions.test.fromDefault.c = 3;
    t.notOk('c' in interactable.options.test.fromDefault, 'modifying defaults does not affect constructed interactables');
    t.end();
});
test('Interactable copies and extends per action defaults', (t) => {
    const scope = helpers.mockScope();
    const { defaults } = scope;
    scope.actions.methodDict = { test: 'testize' };
    scope.Interactable.prototype.testize = function (options) {
        this.setPerAction('test', options);
    };
    defaults.perAction.testModifier = {
        fromDefault: { a: 1, b: 2 },
        specified: null,
    };
    defaults.actions.test = { testModifier: defaults.perAction.testModifier };
    const div = d('div');
    const interactable = scope.interactables.new(div, {});
    interactable.testize({ testModifier: { specified: 'parent' } });
    t.deepEqual(interactable.options.test, {
        enabled: false,
        origin: { x: 0, y: 0 },
        testModifier: {
            fromDefault: { a: 1, b: 2 },
            specified: 'parent',
        },
    }, 'specified options are properly set');
    t.deepEqual(interactable.options.test.testModifier.fromDefault, defaults.perAction.testModifier.fromDefault, 'default options are properly set');
    t.notEqual(interactable.options.test.testModifier.fromDefault, defaults.perAction.testModifier.fromDefault, 'defaults are not aliased');
    defaults.perAction.testModifier.fromDefault.c = 3;
    t.notOk('c' in interactable.options.test.testModifier.fromDefault, 'modifying defaults does not affect constructed interactables');
    t.end();
});
test('Interactable.updatePerActionListeners', (t) => {
    const scope = helpers.mockScope();
    let fired = [];
    function addToFired(event) { fired.push(event); }
    scope.actions.eventTypes.push('teststart', 'testmove', 'testend');
    scope.actions.methodDict = { test: 'testize' };
    scope.Interactable.prototype.testize = function (options) {
        this.setPerAction('test', options);
    };
    scope.defaults.actions.test = {};
    const interactable = scope.interactables.new('target');
    interactable.setPerAction('test', {
        listeners: [{
                start: addToFired,
                move: addToFired,
                end: addToFired,
            }],
    });
    interactable.fire({ type: 'teststart' });
    t.deepEqual(fired.map((e) => e.type), ['teststart']);
    interactable.fire({ type: 'testmove' });
    t.deepEqual(fired.map((e) => e.type), ['teststart', 'testmove']);
    interactable.fire({ type: 'testnotadded' });
    t.deepEqual(fired.map((e) => e.type), ['teststart', 'testmove']);
    interactable.fire({ type: 'testend' });
    t.deepEqual(fired.map((e) => e.type), ['teststart', 'testmove', 'testend']);
    fired = [];
    interactable.setPerAction('test', {
        listeners: [{ start: addToFired }],
    });
    interactable.fire({ type: 'teststart' });
    interactable.fire({ type: 'testmove' });
    interactable.fire({ type: 'testend' });
    t.deepEqual(fired.map((e) => e.type), ['teststart']);
    fired = [];
    interactable.setPerAction('test', {
        listeners: null,
    });
    interactable.fire({ type: 'teststart' });
    interactable.fire({ type: 'testmove' });
    interactable.fire({ type: 'testend' });
    t.deepEqual(fired, []);
    t.end();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZXJhY3RhYmxlLnNwZWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJJbnRlcmFjdGFibGUuc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLENBQUMsTUFBTSwrQkFBK0IsQ0FBQTtBQUM3QyxPQUFPLElBQUksTUFBTSw0QkFBNEIsQ0FBQTtBQUM3QyxPQUFPLEtBQUssT0FBTyxNQUFNLGtCQUFrQixDQUFBO0FBRTNDLElBQUksQ0FBQywwQ0FBMEMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO0lBQ3JELE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxTQUFTLEVBQVMsQ0FBQTtJQUN4QyxNQUFNLEVBQUUsUUFBUSxFQUFFLEdBQUcsS0FBSyxDQUFBO0lBRTFCLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxHQUFHLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFBO0lBRTlDLEtBQUssQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLE9BQU8sR0FBRyxVQUFVLE9BQU87UUFDdEQsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUE7SUFDcEMsQ0FBQyxDQUFBO0lBRUQsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUc7UUFDdEIsV0FBVyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFO1FBQzNCLFNBQVMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRTtLQUMxQixDQUFBO0lBRUQsTUFBTSxTQUFTLEdBQUcsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLENBQUE7SUFFekMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBQ3BCLE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsQ0FBQyxD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WUFBWSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUU7UUFDaEMsU0FBUyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLENBQUM7S0FDbkMsQ0FBQyxDQUFBO0lBRUYsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFBO0lBQ3hDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQTtJQUN2QyxZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUE7SUFDdEMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFBO0lBRXBELEtBQUssR0FBRyxFQUFFLENBQUE7SUFDVixZQUFZLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRTtRQUNoQyxTQUFTLEVBQUUsSUFBSTtLQUNoQixDQUFDLENBQUE7SUFFRixZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUE7SUFDeEMsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFBO0lBQ3ZDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQTtJQUN0QyxDQUFDLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQTtJQUV0QixDQUFDLENBQUMsR0FBRyxFQUFFLENBQUE7QUFDVCxDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBkIGZyb20gJ0BpbnRlcmFjdGpzL19kZXYvdGVzdC9kb21hdG9yJ1xuaW1wb3J0IHRlc3QgZnJvbSAnQGludGVyYWN0anMvX2Rldi90ZXN0L3Rlc3QnXG5pbXBvcnQgKiBhcyBoZWxwZXJzIGZyb20gJy4vdGVzdHMvX2hlbHBlcnMnXG5cbnRlc3QoJ0ludGVyYWN0YWJsZSBjb3BpZXMgYW5kIGV4dGVuZHMgZGVmYXVsdHMnLCAodCkgPT4ge1xuICBjb25zdCBzY29wZSA9IGhlbHBlcnMubW9ja1Njb3BlKCkgYXMgYW55XG4gIGNvbnN0IHsgZGVmYXVsdHMgfSA9IHNjb3BlXG5cbiAgc2NvcGUuYWN0aW9ucy5tZXRob2REaWN0ID0geyB0ZXN0OiAndGVzdGl6ZScgfVxuXG4gIHNjb3BlLkludGVyYWN0YWJsZS5wcm90b3R5cGUudGVzdGl6ZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgdGhpcy5zZXRQZXJBY3Rpb24oJ3Rlc3QnLCBvcHRpb25zKVxuICB9XG5cbiAgZGVmYXVsdHMuYWN0aW9ucy50ZXN0ID0ge1xuICAgIGZyb21EZWZhdWx0OiB7IGE6IDEsIGI6IDIgfSxcbiAgICBzcGVjaWZpZWQ6IHsgYzogMSwgZDogMiB9LFxuICB9XG5cbiAgY29uc3Qgc3BlY2lmaWVkID0geyBzcGVjaWZpZWQ6ICdwYXJlbnQnIH1cblxuICBjb25zdCBkaXYgPSBkKCdkaXYnKVxuICBjb25zdCBpbnRlcmFjdGFibGUgPSBzY29wZS5pbnRlcmFjdGFibGVzLm5ldyhkaXYsIHsgdGVzdDogc3BlY2lmaWVkIH0pXG5cbiAgdC5kZWVwRXF1YWwoaW50ZXJhY3RhYmxlLm9wdGlvbnMudGVzdC5zcGVjaWZpZWQsIHNwZWNpZmllZC5zcGVjaWZpZWQsXG4gICAgJ3NwZWNpZmllZCBvcHRpb25zIGFyZSBwcm9wZXJseSBzZXQnKVxuICB0LmRlZXBFcXVhbChpbnRlcmFjdGFibGUub3B0aW9ucy50ZXN0LmZyb21EZWZhdWx0LCBkZWZhdWx0cy5hY3Rpb25zLnRlc3QuZnJvbURlZmF1bHQsXG4gICAgJ2RlZmF1bHQgb3B0aW9ucyBhcmUgcHJvcGVybHkgc2V0JylcbiAgdC5ub3RFcXVhbChpbnRlcmFjdGFibGUub3B0aW9ucy50ZXN0LmZyb21EZWZhdWx0LCBkZWZhdWx0cy5hY3Rpb25zLnRlc3QuZnJvbURlZmF1bHQsXG4gICAgJ2RlZmF1bHRzIGFyZSBub3QgYWxpYXNlZCcpXG5cbiAgZGVmYXVsdHMuYWN0aW9ucy50ZXN0LmZyb21EZWZhdWx0LmMgPSAzXG4gIHQubm90T2soJ2MnIGluIGludGVyYWN0YWJsZS5vcHRpb25zLnRlc3QuZnJvbURlZmF1bHQsXG4gICAgJ21vZGlmeWluZyBkZWZhdWx0cyBkb2VzIG5vdCBhZmZlY3QgY29uc3RydWN0ZWQgaW50ZXJhY3RhYmxlcycpXG5cbiAgdC5lbmQoKVxufSlcblxudGVzdCgnSW50ZXJhY3RhYmxlIGNvcGllcyBhbmQgZXh0ZW5kcyBwZXIgYWN0aW9uIGRlZmF1bHRzJywgKHQpID0+IHtcbiAgY29uc3Qgc2NvcGUgPSBoZWxwZXJzLm1vY2tTY29wZSgpXG4gIGNvbnN0IHsgZGVmYXVsdHMgfSA9IHNjb3BlXG5cbiAgc2NvcGUuYWN0aW9ucy5tZXRob2REaWN0ID0geyB0ZXN0OiAndGVzdGl6ZScgfVxuXG4gIHNjb3BlLkludGVyYWN0YWJsZS5wcm90b3R5cGUudGVzdGl6ZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgdGhpcy5zZXRQZXJBY3Rpb24oJ3Rlc3QnLCBvcHRpb25zKVxuICB9XG5cbiAgZGVmYXVsdHMucGVyQWN0aW9uLnRlc3RNb2RpZmllciA9IHtcbiAgICBmcm9tRGVmYXVsdDogeyBhOiAxLCBiOiAyIH0sXG4gICAgc3BlY2lmaWVkOiBudWxsLFxuICB9XG4gIGRlZmF1bHRzLmFjdGlvbnMudGVzdCA9IHsgdGVzdE1vZGlmaWVyOiBkZWZhdWx0cy5wZXJBY3Rpb24udGVzdE1vZGlmaWVyIH1cblxuICBjb25zdCBkaXYgPSBkKCdkaXYnKVxuICBjb25zdCBpbnRlcmFjdGFibGUgPSBzY29wZS5pbnRlcmFjdGFibGVzLm5ldyhkaXYsIHt9KVxuICBpbnRlcmFjdGFibGUudGVzdGl6ZSh7IHRlc3RNb2RpZmllcjogeyBzcGVjaWZpZWQ6ICdwYXJlbnQnIH0gfSlcblxuICB0LmRlZXBFcXVhbChpbnRlcmFjdGFibGUub3B0aW9ucy50ZXN0LCB7XG4gICAgZW5hYmxlZDogZmFsc2UsXG4gICAgb3JpZ2luOiB7IHg6IDAsIHk6IDAgfSxcblxuICAgIHRlc3RNb2RpZmllcjoge1xuICAgICAgZnJvbURlZmF1bHQ6IHsgYTogMSwgYjogMiB9LFxuICAgICAgc3BlY2lmaWVkOiAncGFyZW50JyxcbiAgICB9LFxuICB9LCAnc3BlY2lmaWVkIG9wdGlvbnMgYXJlIHByb3Blcmx5IHNldCcpXG4gIHQuZGVlcEVxdWFsKFxuICAgIGludGVyYWN0YWJsZS5vcHRpb25zLnRlc3QudGVzdE1vZGlmaWVyLmZyb21EZWZhdWx0LFxuICAgIGRlZmF1bHRzLnBlckFjdGlvbi50ZXN0TW9kaWZpZXIuZnJvbURlZmF1bHQsXG4gICAgJ2RlZmF1bHQgb3B0aW9ucyBhcmUgcHJvcGVybHkgc2V0JylcbiAgdC5ub3RFcXVhbChcbiAgICBpbnRlcmFjdGFibGUub3B0aW9ucy50ZXN0LnRlc3RNb2RpZmllci5mcm9tRGVmYXVsdCxcbiAgICBkZWZhdWx0cy5wZXJBY3Rpb24udGVzdE1vZGlmaWVyLmZyb21EZWZhdWx0LFxuICAgICdkZWZhdWx0cyBhcmUgbm90IGFsaWFzZWQnKVxuXG4gIGRlZmF1bHRzLnBlckFjdGlvbi50ZXN0TW9kaWZpZXIuZnJvbURlZmF1bHQuYyA9IDNcbiAgdC5ub3RPaygnYycgaW4gaW50ZXJhY3RhYmxlLm9wdGlvbnMudGVzdC50ZXN0TW9kaWZpZXIuZnJvbURlZmF1bHQsXG4gICAgJ21vZGlmeWluZyBkZWZhdWx0cyBkb2VzIG5vdCBhZmZlY3QgY29uc3RydWN0ZWQgaW50ZXJhY3RhYmxlcycpXG5cbiAgdC5lbmQoKVxufSlcblxudGVzdCgnSW50ZXJhY3RhYmxlLnVwZGF0ZVBlckFjdGlvbkxpc3RlbmVycycsICh0KSA9PiB7XG4gIGNvbnN0IHNjb3BlID0gaGVscGVycy5tb2NrU2NvcGUoKVxuXG4gIGxldCBmaXJlZCA9IFtdXG4gIGZ1bmN0aW9uIGFkZFRvRmlyZWQgKGV2ZW50KSB7IGZpcmVkLnB1c2goZXZlbnQpIH1cblxuICBzY29wZS5hY3Rpb25zLmV2ZW50VHlwZXMucHVzaCgndGVzdHN0YXJ0JywgJ3Rlc3Rtb3ZlJywgJ3Rlc3RlbmQnKVxuICBzY29wZS5hY3Rpb25zLm1ldGhvZERpY3QgPSB7IHRlc3Q6ICd0ZXN0aXplJyB9XG4gIHNjb3BlLkludGVyYWN0YWJsZS5wcm90b3R5cGUudGVzdGl6ZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgdGhpcy5zZXRQZXJBY3Rpb24oJ3Rlc3QnLCBvcHRpb25zKVxuICB9XG5cbiAgc2NvcGUuZGVmYXVsdHMuYWN0aW9ucy50ZXN0ID0ge31cblxuICBjb25zdCBpbnRlcmFjdGFibGUgPSBzY29wZS5pbnRlcmFjdGFibGVzLm5ldygndGFyZ2V0JylcblxuICBpbnRlcmFjdGFibGUuc2V0UGVyQWN0aW9uKCd0ZXN0Jywge1xuICAgIGxpc3RlbmVyczogW3tcbiAgICAgIHN0YXJ0OiBhZGRUb0ZpcmVkLFxuICAgICAgbW92ZTogYWRkVG9GaXJlZCxcbiAgICAgIGVuZDogYWRkVG9GaXJlZCxcbiAgICB9XSxcbiAgfSlcblxuICBpbnRlcmFjdGFibGUuZmlyZSh7IHR5cGU6ICd0ZXN0c3RhcnQnIH0pXG4gIHQuZGVlcEVxdWFsKGZpcmVkLm1hcCgoZSkgPT4gZS50eXBlKSwgWyd0ZXN0c3RhcnQnXSlcblxuICBpbnRlcmFjdGFibGUuZmlyZSh7IHR5cGU6ICd0ZXN0bW92ZScgfSlcbiAgdC5kZWVwRXF1YWwoZmlyZWQubWFwKChlKSA9PiBlLnR5cGUpLCBbJ3Rlc3RzdGFydCcsICd0ZXN0bW92ZSddKVxuXG4gIGludGVyYWN0YWJsZS5maXJlKHsgdHlwZTogJ3Rlc3Rub3RhZGRlZCcgfSlcbiAgdC5kZWVwRXF1YWwoZmlyZWQubWFwKChlKSA9PiBlLnR5cGUpLCBbJ3Rlc3RzdGFydCcsICd0ZXN0bW92ZSddKVxuXG4gIGludGVyYWN0YWJsZS5maXJlKHsgdHlwZTogJ3Rlc3RlbmQnIH0pXG4gIHQuZGVlcEVxdWFsKGZpcmVkLm1hcCgoZSkgPT4gZS50eXBlKSwgWyd0ZXN0c3RhcnQnLCAndGVzdG1vdmUnLCAndGVzdGVuZCddKVxuXG4gIGZpcmVkID0gW11cbiAgaW50ZXJhY3RhYmxlLnNldFBlckFjdGlvbigndGVzdCcsIHtcbiAgICBsaXN0ZW5lcnM6IFt7IHN0YXJ0OiBhZGRUb0ZpcmVkIH1dLFxuICB9KVxuXG4gIGludGVyYWN0YWJsZS5maXJlKHsgdHlwZTogJ3Rlc3RzdGFydCcgfSlcbiAgaW50ZXJhY3RhYmxlLmZpcmUoeyB0eXBlOiAndGVzdG1vdmUnIH0pXG4gIGludGVyYWN0YWJsZS5maXJlKHsgdHlwZTogJ3Rlc3RlbmQnIH0pXG4gIHQuZGVlcEVxdWFsKGZpcmVkLm1hcCgoZSkgPT4gZS50eXBlKSwgWyd0ZXN0c3RhcnQnXSlcblxuICBmaXJlZCA9IFtdXG4gIGludGVyYWN0YWJsZS5zZXRQZXJBY3Rpb24oJ3Rlc3QnLCB7XG4gICAgbGlzdGVuZXJzOiBudWxsLFxuICB9KVxuXG4gIGludGVyYWN0YWJsZS5maXJlKHsgdHlwZTogJ3Rlc3RzdGFydCcgfSlcbiAgaW50ZXJhY3RhYmxlLmZpcmUoeyB0eXBlOiAndGVzdG1vdmUnIH0pXG4gIGludGVyYWN0YWJsZS5maXJlKHsgdHlwZTogJ3Rlc3RlbmQnIH0pXG4gIHQuZGVlcEVxdWFsKGZpcmVkLCBbXSlcblxuICB0LmVuZCgpXG59KVxuIl19