import test from '@interactjs/_dev/test/test';
import Eventable from '@interactjs/core/Eventable';
import interactions from '@interactjs/core/interactions';
import * as helpers from '@interactjs/core/tests/_helpers';
import Signals from '@interactjs/utils/Signals';
import pointerEvents from './base';
import holdRepeat from './holdRepeat';
function mockScope() {
    return helpers.mockScope({
        pointerEvents: {
            defaults: {},
            signals: new Signals(),
            types: [],
            fire: () => { },
        },
    });
}
test('holdRepeat count', (t) => {
    const scope = mockScope();
    const pointerEvent = {
        type: 'hold',
        count: 0,
    };
    pointerEvents.install(scope);
    holdRepeat.install(scope);
    scope.pointerEvents.signals.fire('new', { pointerEvent });
    t.equal(pointerEvent.count, 1, 'first hold count is 1 with count previously undefined');
    const count = 20;
    pointerEvent.count = count;
    scope.pointerEvents.signals.fire('new', { pointerEvent });
    t.equal(pointerEvent.count, count + 1, 'existing hold count is incremented');
    t.end();
});
test('holdRepeat onFired', (t) => {
    const scope = mockScope();
    interactions.install(scope);
    pointerEvents.install(scope);
    holdRepeat.install(scope);
    const interaction = scope.interactions.new({});
    const pointerEvent = {
        type: 'hold',
    };
    const eventTarget = {};
    const eventable = new Eventable(Object.assign({}, scope.pointerEvents.defaults, {
        holdRepeatInterval: 0,
    }));
    const signalArg = {
        interaction,
        pointerEvent,
        eventTarget,
        targets: [{
                eventable,
            }],
    };
    scope.pointerEvents.signals.fire('fired', signalArg);
    t.notOk('holdIntervalHandle' in interaction, 'interaction interval handle was not saved with 0 holdRepeatInterval');
    eventable.options.holdRepeatInterval = 10;
    scope.pointerEvents.signals.fire('fired', signalArg);
    t.ok('holdIntervalHandle' in interaction, 'interaction interval handle was saved with interval > 0');
    clearInterval(interaction.holdIntervalHandle);
    pointerEvent.type = 'NOT_HOLD';
    delete interaction.holdIntervalHandle;
    scope.pointerEvents.signals.fire('fired', signalArg);
    t.notOk('holdIntervalHandle' in interaction, 'interaction interval handle is not saved if pointerEvent.type is not "hold"');
    t.end();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG9sZFJlcGVhdC5zcGVjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaG9sZFJlcGVhdC5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sSUFBSSxNQUFNLDRCQUE0QixDQUFBO0FBQzdDLE9BQU8sU0FBUyxNQUFNLDRCQUE0QixDQUFBO0FBQ2xELE9BQU8sWUFBWSxNQUFNLCtCQUErQixDQUFBO0FBQ3hELE9BQU8sS0FBSyxPQUFPLE1BQU0saUNBQWlDLENBQUE7QUFDMUQsT0FBTyxPQUFPLE1BQU0sMkJBQTJCLENBQUE7QUFDL0MsT0FBTyxhQUFhLE1BQU0sUUFBUSxDQUFBO0FBQ2xDLE9BQU8sVUFBVSxNQUFNLGNBQWMsQ0FBQTtBQUVyQyxTQUFTLFNBQVM7SUFDaEIsT0FBTyxPQUFPLENBQUMsU0FBUyxDQUFDO1FBQ3ZCLGFBQWEsRUFBRTtZQUNiLFFBQVEsRUFBRSxFQUFFO1lBQ1osT0FBTyxFQUFFLElBQUksT0FBTyxFQUFFO1lBQ3RCLEtBQUssRUFBRSxFQUFFO1lBQ1QsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFFLENBQUM7U0FDZjtLQUNGLENBQUMsQ0FBQTtBQUNKLENBQUM7QUFFRCxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtJQUM3QixNQUFNLEtBQUssR0FBRyxTQUFTLEVBQUUsQ0FBQTtJQUN6QixNQUFNLFlBQVksR0FBRztRQUNuQixJQUFJLEVBQUUsTUFBTTtRQUNaLEtBQUssRUFBRSxDQUFDO0tBQ1QsQ0FBQTtJQUVELGFBQWEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDNUIsVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUV6QixLQUFLLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQTtJQUN6RCxDQUFDLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLHVEQUF1RCxDQUFDLENBQUE7SUFFdkYsTUFBTSxLQUFLLEdBQUcsRUFBRSxDQUFBO0lBQ2hCLFlBQVksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFBO0lBQzFCLEtBQUssQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFBO0lBQ3pELENBQUMsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUFFLG9DQUFvQyxDQUFDLENBQUE7SUFFNUUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFBO0FBQ1QsQ0FBQyxDQUFDLENBQUE7QUFFRixJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtJQUMvQixNQUFNLEtBQUssR0FBRyxTQUFTLEVBQUUsQ0FBQTtJQUN6QixZQUFZLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBQzNCLGFBQWEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDNUIsVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUV6QixNQUFNLFdBQVcsR0FBRyxLQUFLLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUM5QyxNQUFNLFlBQVksR0FBRztRQUNuQixJQUFJLEVBQUUsTUFBTTtLQUNiLENBQUE7SUFDRCxNQUFNLFdBQVcsR0FBRyxFQUFFLENBQUE7SUFDdEIsTUFBTSxTQUFTLEdBQUcsSUFBSSxTQUFTLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUU7UUFDOUUsa0JBQWtCLEVBQUUsQ0FBQztLQUN0QixDQUFDLENBQUMsQ0FBQTtJQUNILE1BQU0sU0FBUyxHQUFHO1FBQ2hCLFdBQVc7UUFDWCxZQUFZO1FBQ1osV0FBVztRQUNYLE9BQU8sRUFBRSxDQUFDO2dCQUNSLFNBQVM7YUFDVixDQUFDO0tBQ0gsQ0FBQTtJQUVELEtBQUssQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUE7SUFDcEQsQ0FBQyxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsSUFBSSxXQUFXLEVBQ3pDLHFFQUFxRSxDQUFDLENBQUE7SUFFeEUsU0FBUyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsR0FBRyxFQUFFLENBQUE7SUFDekMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQTtJQUNwRCxDQUFDLENBQUMsRUFBRSxDQUFDLG9CQUFvQixJQUFJLFdBQVcsRUFDdEMseURBQXlELENBQUMsQ0FBQTtJQUU1RCxhQUFhLENBQUMsV0FBVyxDQUFDLGtCQUFrQixDQUFDLENBQUE7SUFFN0MsWUFBWSxDQUFDLElBQUksR0FBRyxVQUFVLENBQUE7SUFDOUIsT0FBTyxXQUFXLENBQUMsa0JBQWtCLENBQUE7SUFDckMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQTtJQUNwRCxDQUFDLENBQUMsS0FBSyxDQUFDLG9CQUFvQixJQUFJLFdBQVcsRUFDekMsNkVBQTZFLENBQUMsQ0FBQTtJQUVoRixDQUFDLENBQUMsR0FBRyxFQUFFLENBQUE7QUFDVCxDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0ZXN0IGZyb20gJ0BpbnRlcmFjdGpzL19kZXYvdGVzdC90ZXN0J1xuaW1wb3J0IEV2ZW50YWJsZSBmcm9tICdAaW50ZXJhY3Rqcy9jb3JlL0V2ZW50YWJsZSdcbmltcG9ydCBpbnRlcmFjdGlvbnMgZnJvbSAnQGludGVyYWN0anMvY29yZS9pbnRlcmFjdGlvbnMnXG5pbXBvcnQgKiBhcyBoZWxwZXJzIGZyb20gJ0BpbnRlcmFjdGpzL2NvcmUvdGVzdHMvX2hlbHBlcnMnXG5pbXBvcnQgU2lnbmFscyBmcm9tICdAaW50ZXJhY3Rqcy91dGlscy9TaWduYWxzJ1xuaW1wb3J0IHBvaW50ZXJFdmVudHMgZnJvbSAnLi9iYXNlJ1xuaW1wb3J0IGhvbGRSZXBlYXQgZnJvbSAnLi9ob2xkUmVwZWF0J1xuXG5mdW5jdGlvbiBtb2NrU2NvcGUgKCkge1xuICByZXR1cm4gaGVscGVycy5tb2NrU2NvcGUoe1xuICAgIHBvaW50ZXJFdmVudHM6IHtcbiAgICAgIGRlZmF1bHRzOiB7fSxcbiAgICAgIHNpZ25hbHM6IG5ldyBTaWduYWxzKCksXG4gICAgICB0eXBlczogW10sXG4gICAgICBmaXJlOiAoKSA9PiB7fSxcbiAgICB9LFxuICB9KVxufVxuXG50ZXN0KCdob2xkUmVwZWF0IGNvdW50JywgKHQpID0+IHtcbiAgY29uc3Qgc2NvcGUgPSBtb2NrU2NvcGUoKVxuICBjb25zdCBwb2ludGVyRXZlbnQgPSB7XG4gICAgdHlwZTogJ2hvbGQnLFxuICAgIGNvdW50OiAwLFxuICB9XG5cbiAgcG9pbnRlckV2ZW50cy5pbnN0YWxsKHNjb3BlKVxuICBob2xkUmVwZWF0Lmluc3RhbGwoc2NvcGUpXG5cbiAgc2NvcGUucG9pbnRlckV2ZW50cy5zaWduYWxzLmZpcmUoJ25ldycsIHsgcG9pbnRlckV2ZW50IH0pXG4gIHQuZXF1YWwocG9pbnRlckV2ZW50LmNvdW50LCAxLCAnZmlyc3QgaG9sZCBjb3VudCBpcyAxIHdpdGggY291bnQgcHJldmlvdXNseSB1bmRlZmluZWQnKVxuXG4gIGNvbnN0IGNvdW50ID0gMjBcbiAgcG9pbnRlckV2ZW50LmNvdW50ID0gY291bnRcbiAgc2NvcGUucG9pbnRlckV2ZW50cy5zaWduYWxzLmZpcmUoJ25ldycsIHsgcG9pbnRlckV2ZW50IH0pXG4gIHQuZXF1YWwocG9pbnRlckV2ZW50LmNvdW50LCBjb3VudCArIDEsICdleGlzdGluZyBob2xkIGNvdW50IGlzIGluY3JlbWVudGVkJylcblxuICB0LmVuZCgpXG59KVxuXG50ZXN0KCdob2xkUmVwZWF0IG9uRmlyZWQnLCAodCkgPT4ge1xuICBjb25zdCBzY29wZSA9IG1vY2tTY29wZSgpXG4gIGludGVyYWN0aW9ucy5pbnN0YWxsKHNjb3BlKVxuICBwb2ludGVyRXZlbnRzLmluc3RhbGwoc2NvcGUpXG4gIGhvbGRSZXBlYXQuaW5zdGFsbChzY29wZSlcblxuICBjb25zdCBpbnRlcmFjdGlvbiA9IHNjb3BlLmludGVyYWN0aW9ucy5uZXcoe30pXG4gIGNvbnN0IHBvaW50ZXJFdmVudCA9IHtcbiAgICB0eXBlOiAnaG9sZCcsXG4gIH1cbiAgY29uc3QgZXZlbnRUYXJnZXQgPSB7fVxuICBjb25zdCBldmVudGFibGUgPSBuZXcgRXZlbnRhYmxlKE9iamVjdC5hc3NpZ24oe30sIHNjb3BlLnBvaW50ZXJFdmVudHMuZGVmYXVsdHMsIHtcbiAgICBob2xkUmVwZWF0SW50ZXJ2YWw6IDAsXG4gIH0pKVxuICBjb25zdCBzaWduYWxBcmcgPSB7XG4gICAgaW50ZXJhY3Rpb24sXG4gICAgcG9pbnRlckV2ZW50LFxuICAgIGV2ZW50VGFyZ2V0LFxuICAgIHRhcmdldHM6IFt7XG4gICAgICBldmVudGFibGUsXG4gICAgfV0sXG4gIH1cblxuICBzY29wZS5wb2ludGVyRXZlbnRzLnNpZ25hbHMuZmlyZSgnZmlyZWQnLCBzaWduYWxBcmcpXG4gIHQubm90T2soJ2hvbGRJbnRlcnZhbEhhbmRsZScgaW4gaW50ZXJhY3Rpb24sXG4gICAgJ2ludGVyYWN0aW9uIGludGVydmFsIGhhbmRsZSB3YXMgbm90IHNhdmVkIHdpdGggMCBob2xkUmVwZWF0SW50ZXJ2YWwnKVxuXG4gIGV2ZW50YWJsZS5vcHRpb25zLmhvbGRSZXBlYXRJbnRlcnZhbCA9IDEwXG4gIHNjb3BlLnBvaW50ZXJFdmVudHMuc2lnbmFscy5maXJlKCdmaXJlZCcsIHNpZ25hbEFyZylcbiAgdC5vaygnaG9sZEludGVydmFsSGFuZGxlJyBpbiBpbnRlcmFjdGlvbixcbiAgICAnaW50ZXJhY3Rpb24gaW50ZXJ2YWwgaGFuZGxlIHdhcyBzYXZlZCB3aXRoIGludGVydmFsID4gMCcpXG5cbiAgY2xlYXJJbnRlcnZhbChpbnRlcmFjdGlvbi5ob2xkSW50ZXJ2YWxIYW5kbGUpXG5cbiAgcG9pbnRlckV2ZW50LnR5cGUgPSAnTk9UX0hPTEQnXG4gIGRlbGV0ZSBpbnRlcmFjdGlvbi5ob2xkSW50ZXJ2YWxIYW5kbGVcbiAgc2NvcGUucG9pbnRlckV2ZW50cy5zaWduYWxzLmZpcmUoJ2ZpcmVkJywgc2lnbmFsQXJnKVxuICB0Lm5vdE9rKCdob2xkSW50ZXJ2YWxIYW5kbGUnIGluIGludGVyYWN0aW9uLFxuICAgICdpbnRlcmFjdGlvbiBpbnRlcnZhbCBoYW5kbGUgaXMgbm90IHNhdmVkIGlmIHBvaW50ZXJFdmVudC50eXBlIGlzIG5vdCBcImhvbGRcIicpXG5cbiAgdC5lbmQoKVxufSlcbiJdfQ==