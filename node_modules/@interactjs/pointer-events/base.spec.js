import Eventable from '@interactjs/core/Eventable';
import Interaction from '@interactjs/core/Interaction';
import interactions from '@interactjs/core/interactions';
import * as helpers from '@interactjs/core/tests/_helpers';
import Signals from '@interactjs/utils/Signals';
import test from '@interactjs/_dev/test/test';
import pointerEvents from './base';
test('pointerEvents.types', t => {
    t.deepEqual(pointerEvents.types, [
        'down',
        'move',
        'up',
        'cancel',
        'tap',
        'doubletap',
        'hold',
    ], 'pointerEvents.types is as expected');
    t.end();
});
test('pointerEvents.fire', t => {
    const eventable = new Eventable(pointerEvents.defaults);
    const type = 'TEST';
    const element = {};
    const eventTarget = {};
    const TEST_PROP = ['TEST_PROP'];
    let firedEvent;
    eventable.on(type, event => { firedEvent = event; });
    pointerEvents.fire({
        type,
        eventTarget,
        pointer: {},
        event: {},
        interaction: {},
        targets: [{
                eventable,
                element,
                props: {
                    TEST_PROP,
                },
            }],
    });
    t.ok(firedEvent instanceof pointerEvents.PointerEvent, 'Fired event is an instance of pointerEvents.PointerEvent');
    t.equal(firedEvent.type, type, 'Fired event type is correct');
    t.equal(firedEvent.currentTarget, element, 'Fired event currentTarget is correct');
    t.equal(firedEvent.target, eventTarget, 'Fired event target is correct');
    t.equal(firedEvent.TEST_PROP, TEST_PROP, 'Fired event has props from target.props');
    const tapTime = 500;
    const interaction = Object.assign(new Interaction({ signals: new Signals() }), { tapTime: -1, prevTap: null });
    interaction.updatePointer({}, {}, null);
    const tapEvent = Object.assign(new pointerEvents.PointerEvent('tap', {}, {}, null, interaction), {
        timeStamp: tapTime,
    });
    pointerEvents.fire({
        pointerEvent: tapEvent,
        interaction,
        targets: [{
                eventable,
                element,
            }],
    });
    t.equal(interaction.tapTime, tapTime, 'interaction.tapTime is updated');
    t.equal(interaction.prevTap, tapEvent, 'interaction.prevTap is updated');
    t.end();
});
test('pointerEvents.collectEventTargets', t => {
    const type = 'TEST';
    const TEST_PROP = ['TEST_PROP'];
    const target = {
        TEST_PROP,
        eventable: new Eventable(pointerEvents.defaults),
    };
    let collectedTargets;
    function onCollect({ targets }) {
        targets.push(target);
        collectedTargets = targets;
    }
    pointerEvents.signals.on('collect-targets', onCollect);
    pointerEvents.collectEventTargets({
        interaction: new Interaction({ signals: helpers.mockSignals() }),
        pointer: {},
        event: {},
        eventTarget: {},
        type,
    });
    t.deepEqual(collectedTargets, [target]);
    pointerEvents.signals.off('collect-targets', onCollect);
    t.end();
});
test('pointerEvents Interaction update-pointer signal', t => {
    const scope = helpers.mockScope();
    interactions.install(scope);
    pointerEvents.install(scope);
    const interaction = scope.interactions.new({});
    const initialHold = { duration: Infinity, timeout: null };
    const event = {};
    interaction.updatePointer(helpers.newPointer(0), event, null, false);
    t.deepEqual(interaction.pointers.map(p => p.hold), [initialHold], 'set hold info for move on new pointer');
    interaction.removePointer(helpers.newPointer(0), event);
    interaction.updatePointer(helpers.newPointer(0), event, null, true);
    t.deepEqual(interaction.pointers.map(p => p.hold), [initialHold]);
    interaction.updatePointer(helpers.newPointer(5), event, null, true);
    t.deepEqual(interaction.pointers.map(p => p.hold), [initialHold, initialHold]);
    t.end();
});
test('pointerEvents Interaction remove-pointer signal', t => {
    const scope = helpers.mockScope();
    interactions.install(scope);
    pointerEvents.install(scope);
    const interaction = scope.interactions.new({});
    const ids = [0, 1, 2, 3];
    const removals = [
        { id: 0, remain: [1, 2, 3], message: 'first of 4' },
        { id: 2, remain: [1, 3], message: 'middle of 3' },
        { id: 3, remain: [1], message: 'last of 2' },
        { id: 1, remain: [], message: 'final' },
    ];
    for (const id of ids) {
        const index = interaction.updatePointer({ pointerId: id }, {}, null, true);
        // use the ids as the pointerInfo.hold value for this test
        interaction.pointers[index].hold = id;
    }
    for (const removal of removals) {
        interaction.removePointer({ pointerId: removal.id }, null);
        t.deepEqual(interaction.pointers.map(p => p.hold), removal.remain, `${removal.message} - remaining interaction.holdTimers is correct`);
    }
    t.end();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5zcGVjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYmFzZS5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sU0FBUyxNQUFNLDRCQUE0QixDQUFBO0FBQ2xELE9BQU8sV0FBVyxNQUFNLDhCQUE4QixDQUFBO0FBQ3RELE9BQU8sWUFBWSxNQUFNLCtCQUErQixDQUFBO0FBQ3hELE9BQU8sS0FBSyxPQUFPLE1BQU0saUNBQWlDLENBQUE7QUFDMUQsT0FBTyxPQUFPLE1BQU0sMkJBQTJCLENBQUE7QUFDL0MsT0FBTyxJQUFJLE1BQU0sNEJBQTRCLENBQUE7QUFDN0MsT0FBTyxhQUFhLE1BQU0sUUFBUSxDQUFBO0FBRWxDLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLENBQUMsRUFBRTtJQUM5QixDQUFDLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQzdCO1FBQ0UsTUFBTTtRQUNOLE1BQU07UUFDTixJQUFJO1FBQ0osUUFBUTtRQUNSLEtBQUs7UUFDTCxXQUFXO1FBQ1gsTUFBTTtLQUNQLEVBQ0Qsb0NBQW9DLENBQUMsQ0FBQTtJQUV2QyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUE7QUFDVCxDQUFDLENBQUMsQ0FBQTtBQUVGLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLENBQUMsRUFBRTtJQUM3QixNQUFNLFNBQVMsR0FBRyxJQUFJLFNBQVMsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDdkQsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFBO0lBQ25CLE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQTtJQUNsQixNQUFNLFdBQVcsR0FBRyxFQUFFLENBQUE7SUFDdEIsTUFBTSxTQUFTLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQTtJQUMvQixJQUFJLFVBQVUsQ0FBQTtJQUVkLFNBQVMsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxFQUFFLEdBQUcsVUFBVSxHQUFHLEtBQUssQ0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBRW5ELGFBQWEsQ0FBQyxJQUFJLENBQUM7UUFDakIsSUFBSTtRQUNKLFdBQVc7UUFDWCxPQUFPLEVBQUUsRUFBRTtRQUNYLEtBQUssRUFBRSxFQUFFO1FBQ1QsV0FBVyxFQUFFLEVBQUU7UUFDZixPQUFPLEVBQUUsQ0FBQztnQkFDUixTQUFTO2dCQUNULE9BQU87Z0JBQ1AsS0FBSyxFQUFFO29CQUNMLFNBQVM7aUJBQ1Y7YUFDRixDQUFDO0tBQ0ksQ0FBQyxDQUFBO0lBRVQsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxVQUFVLFlBQVksYUFBYSxDQUFDLFlBQVksRUFDbkQsMERBQTBELENBQUMsQ0FBQTtJQUM3RCxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUMzQiw2QkFBNkIsQ0FBQyxDQUFBO0lBQ2hDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxPQUFPLEVBQ3ZDLHNDQUFzQyxDQUFDLENBQUE7SUFDekMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLFdBQVcsRUFDcEMsK0JBQStCLENBQUMsQ0FBQTtJQUNsQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxTQUFTLEVBQUUsU0FBUyxFQUNyQyx5Q0FBeUMsQ0FBQyxDQUFBO0lBRTVDLE1BQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQTtJQUNuQixNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUMvQixJQUFJLFdBQVcsQ0FBQyxFQUFFLE9BQU8sRUFBRSxJQUFJLE9BQU8sRUFBRSxFQUFTLENBQUMsRUFDbEQsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUE7SUFFakMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxFQUFTLEVBQUUsRUFBUyxFQUFFLElBQUksQ0FBQyxDQUFBO0lBRXJELE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxhQUFhLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxXQUFXLENBQUMsRUFBRTtRQUMvRixTQUFTLEVBQUUsT0FBTztLQUNuQixDQUFDLENBQUE7SUFFRixhQUFhLENBQUMsSUFBSSxDQUFDO1FBQ2pCLFlBQVksRUFBRSxRQUFRO1FBQ3RCLFdBQVc7UUFDWCxPQUFPLEVBQUUsQ0FBQztnQkFDUixTQUFTO2dCQUNULE9BQU87YUFDUixDQUFDO0tBQ0ksQ0FBQyxDQUFBO0lBRVQsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFDbEMsZ0NBQWdDLENBQUMsQ0FBQTtJQUNuQyxDQUFDLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUNuQyxnQ0FBZ0MsQ0FBQyxDQUFBO0lBRW5DLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtBQUNULENBQUMsQ0FBQyxDQUFBO0FBRUYsSUFBSSxDQUFDLG1DQUFtQyxFQUFFLENBQUMsQ0FBQyxFQUFFO0lBQzVDLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQTtJQUNuQixNQUFNLFNBQVMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFBO0lBQy9CLE1BQU0sTUFBTSxHQUFHO1FBQ2IsU0FBUztRQUNULFNBQVMsRUFBRSxJQUFJLFNBQVMsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDO0tBQ2pELENBQUE7SUFDRCxJQUFJLGdCQUFnQixDQUFBO0lBRXBCLFNBQVMsU0FBUyxDQUFFLEVBQUUsT0FBTyxFQUFFO1FBQzdCLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUE7UUFFcEIsZ0JBQWdCLEdBQUcsT0FBTyxDQUFBO0lBQzVCLENBQUM7SUFFRCxhQUFhLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxTQUFTLENBQUMsQ0FBQTtJQUN0RCxhQUFhLENBQUMsbUJBQW1CLENBQUM7UUFDaEMsV0FBVyxFQUFFLElBQUksV0FBVyxDQUFDLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxXQUFXLEVBQUUsRUFBUyxDQUFDO1FBQ3ZFLE9BQU8sRUFBRSxFQUFFO1FBQ1gsS0FBSyxFQUFFLEVBQUU7UUFDVCxXQUFXLEVBQUUsRUFBRTtRQUNmLElBQUk7S0FDRSxDQUFDLENBQUE7SUFFVCxDQUFDLENBQUMsU0FBUyxDQUFDLGdCQUFnQixFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQTtJQUV2QyxhQUFhLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxTQUFTLENBQUMsQ0FBQTtJQUV2RCxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUE7QUFDVCxDQUFDLENBQUMsQ0FBQTtBQUVGLElBQUksQ0FBQyxpREFBaUQsRUFBRSxDQUFDLENBQUMsRUFBRTtJQUMxRCxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsU0FBUyxFQUFFLENBQUE7SUFFakMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUMzQixhQUFhLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBRTVCLE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFBO0lBQzlDLE1BQU0sV0FBVyxHQUFHLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUE7SUFDekQsTUFBTSxLQUFLLEdBQUcsRUFBK0IsQ0FBQTtJQUU3QyxXQUFXLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQTtJQUNwRSxDQUFDLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsdUNBQXVDLENBQUMsQ0FBQTtJQUUxRyxXQUFXLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUE7SUFFdkQsV0FBVyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDbkUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUE7SUFFakUsV0FBVyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDbkUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFBO0lBRTlFLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtBQUNULENBQUMsQ0FBQyxDQUFBO0FBRUYsSUFBSSxDQUFDLGlEQUFpRCxFQUFFLENBQUMsQ0FBQyxFQUFFO0lBQzFELE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQTtJQUVqQyxZQUFZLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBQzNCLGFBQWEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUE7SUFFNUIsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUE7SUFFOUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUN4QixNQUFNLFFBQVEsR0FBRztRQUNmLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxZQUFZLEVBQUc7UUFDcEQsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUMsRUFBSyxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsYUFBYSxFQUFFO1FBQ3BELEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQU8sRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFJO1FBQ3BELEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsRUFBUyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQVE7S0FDckQsQ0FBQTtJQUVELEtBQUssTUFBTSxFQUFFLElBQUksR0FBRyxFQUFFO1FBQ3BCLE1BQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxhQUFhLENBQUMsRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUEwQixFQUFFLEVBQStCLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQy9ILDBEQUEwRDtRQUMxRCxXQUFXLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksR0FBRyxFQUFTLENBQUE7S0FDN0M7SUFFRCxLQUFLLE1BQU0sT0FBTyxJQUFJLFFBQVEsRUFBRTtRQUM5QixXQUFXLENBQUMsYUFBYSxDQUFDLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxFQUFFLEVBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUVqRSxDQUFDLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sQ0FBQyxNQUFNLEVBQy9ELEdBQUcsT0FBTyxDQUFDLE9BQU8sZ0RBQWdELENBQUMsQ0FBQTtLQUN0RTtJQUVELENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtBQUNULENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEV2ZW50YWJsZSBmcm9tICdAaW50ZXJhY3Rqcy9jb3JlL0V2ZW50YWJsZSdcbmltcG9ydCBJbnRlcmFjdGlvbiBmcm9tICdAaW50ZXJhY3Rqcy9jb3JlL0ludGVyYWN0aW9uJ1xuaW1wb3J0IGludGVyYWN0aW9ucyBmcm9tICdAaW50ZXJhY3Rqcy9jb3JlL2ludGVyYWN0aW9ucydcbmltcG9ydCAqIGFzIGhlbHBlcnMgZnJvbSAnQGludGVyYWN0anMvY29yZS90ZXN0cy9faGVscGVycydcbmltcG9ydCBTaWduYWxzIGZyb20gJ0BpbnRlcmFjdGpzL3V0aWxzL1NpZ25hbHMnXG5pbXBvcnQgdGVzdCBmcm9tICdAaW50ZXJhY3Rqcy9fZGV2L3Rlc3QvdGVzdCdcbmltcG9ydCBwb2ludGVyRXZlbnRzIGZyb20gJy4vYmFzZSdcblxudGVzdCgncG9pbnRlckV2ZW50cy50eXBlcycsIHQgPT4ge1xuICB0LmRlZXBFcXVhbChwb2ludGVyRXZlbnRzLnR5cGVzLFxuICAgIFtcbiAgICAgICdkb3duJyxcbiAgICAgICdtb3ZlJyxcbiAgICAgICd1cCcsXG4gICAgICAnY2FuY2VsJyxcbiAgICAgICd0YXAnLFxuICAgICAgJ2RvdWJsZXRhcCcsXG4gICAgICAnaG9sZCcsXG4gICAgXSxcbiAgICAncG9pbnRlckV2ZW50cy50eXBlcyBpcyBhcyBleHBlY3RlZCcpXG5cbiAgdC5lbmQoKVxufSlcblxudGVzdCgncG9pbnRlckV2ZW50cy5maXJlJywgdCA9PiB7XG4gIGNvbnN0IGV2ZW50YWJsZSA9IG5ldyBFdmVudGFibGUocG9pbnRlckV2ZW50cy5kZWZhdWx0cylcbiAgY29uc3QgdHlwZSA9ICdURVNUJ1xuICBjb25zdCBlbGVtZW50ID0ge31cbiAgY29uc3QgZXZlbnRUYXJnZXQgPSB7fVxuICBjb25zdCBURVNUX1BST1AgPSBbJ1RFU1RfUFJPUCddXG4gIGxldCBmaXJlZEV2ZW50XG5cbiAgZXZlbnRhYmxlLm9uKHR5cGUsIGV2ZW50ID0+IHsgZmlyZWRFdmVudCA9IGV2ZW50IH0pXG5cbiAgcG9pbnRlckV2ZW50cy5maXJlKHtcbiAgICB0eXBlLFxuICAgIGV2ZW50VGFyZ2V0LFxuICAgIHBvaW50ZXI6IHt9LFxuICAgIGV2ZW50OiB7fSxcbiAgICBpbnRlcmFjdGlvbjoge30sXG4gICAgdGFyZ2V0czogW3tcbiAgICAgIGV2ZW50YWJsZSxcbiAgICAgIGVsZW1lbnQsXG4gICAgICBwcm9wczoge1xuICAgICAgICBURVNUX1BST1AsXG4gICAgICB9LFxuICAgIH1dLFxuICB9IGFzIGFueSlcblxuICB0Lm9rKGZpcmVkRXZlbnQgaW5zdGFuY2VvZiBwb2ludGVyRXZlbnRzLlBvaW50ZXJFdmVudCxcbiAgICAnRmlyZWQgZXZlbnQgaXMgYW4gaW5zdGFuY2Ugb2YgcG9pbnRlckV2ZW50cy5Qb2ludGVyRXZlbnQnKVxuICB0LmVxdWFsKGZpcmVkRXZlbnQudHlwZSwgdHlwZSxcbiAgICAnRmlyZWQgZXZlbnQgdHlwZSBpcyBjb3JyZWN0JylcbiAgdC5lcXVhbChmaXJlZEV2ZW50LmN1cnJlbnRUYXJnZXQsIGVsZW1lbnQsXG4gICAgJ0ZpcmVkIGV2ZW50IGN1cnJlbnRUYXJnZXQgaXMgY29ycmVjdCcpXG4gIHQuZXF1YWwoZmlyZWRFdmVudC50YXJnZXQsIGV2ZW50VGFyZ2V0LFxuICAgICdGaXJlZCBldmVudCB0YXJnZXQgaXMgY29ycmVjdCcpXG4gIHQuZXF1YWwoZmlyZWRFdmVudC5URVNUX1BST1AsIFRFU1RfUFJPUCxcbiAgICAnRmlyZWQgZXZlbnQgaGFzIHByb3BzIGZyb20gdGFyZ2V0LnByb3BzJylcblxuICBjb25zdCB0YXBUaW1lID0gNTAwXG4gIGNvbnN0IGludGVyYWN0aW9uID0gT2JqZWN0LmFzc2lnbihcbiAgICBuZXcgSW50ZXJhY3Rpb24oeyBzaWduYWxzOiBuZXcgU2lnbmFscygpIH0gYXMgYW55KSxcbiAgICB7IHRhcFRpbWU6IC0xLCBwcmV2VGFwOiBudWxsIH0pXG5cbiAgaW50ZXJhY3Rpb24udXBkYXRlUG9pbnRlcih7fSBhcyBhbnksIHt9IGFzIGFueSwgbnVsbClcblxuICBjb25zdCB0YXBFdmVudCA9IE9iamVjdC5hc3NpZ24obmV3IHBvaW50ZXJFdmVudHMuUG9pbnRlckV2ZW50KCd0YXAnLCB7fSwge30sIG51bGwsIGludGVyYWN0aW9uKSwge1xuICAgIHRpbWVTdGFtcDogdGFwVGltZSxcbiAgfSlcblxuICBwb2ludGVyRXZlbnRzLmZpcmUoe1xuICAgIHBvaW50ZXJFdmVudDogdGFwRXZlbnQsXG4gICAgaW50ZXJhY3Rpb24sXG4gICAgdGFyZ2V0czogW3tcbiAgICAgIGV2ZW50YWJsZSxcbiAgICAgIGVsZW1lbnQsXG4gICAgfV0sXG4gIH0gYXMgYW55KVxuXG4gIHQuZXF1YWwoaW50ZXJhY3Rpb24udGFwVGltZSwgdGFwVGltZSxcbiAgICAnaW50ZXJhY3Rpb24udGFwVGltZSBpcyB1cGRhdGVkJylcbiAgdC5lcXVhbChpbnRlcmFjdGlvbi5wcmV2VGFwLCB0YXBFdmVudCxcbiAgICAnaW50ZXJhY3Rpb24ucHJldlRhcCBpcyB1cGRhdGVkJylcblxuICB0LmVuZCgpXG59KVxuXG50ZXN0KCdwb2ludGVyRXZlbnRzLmNvbGxlY3RFdmVudFRhcmdldHMnLCB0ID0+IHtcbiAgY29uc3QgdHlwZSA9ICdURVNUJ1xuICBjb25zdCBURVNUX1BST1AgPSBbJ1RFU1RfUFJPUCddXG4gIGNvbnN0IHRhcmdldCA9IHtcbiAgICBURVNUX1BST1AsXG4gICAgZXZlbnRhYmxlOiBuZXcgRXZlbnRhYmxlKHBvaW50ZXJFdmVudHMuZGVmYXVsdHMpLFxuICB9XG4gIGxldCBjb2xsZWN0ZWRUYXJnZXRzXG5cbiAgZnVuY3Rpb24gb25Db2xsZWN0ICh7IHRhcmdldHMgfSkge1xuICAgIHRhcmdldHMucHVzaCh0YXJnZXQpXG5cbiAgICBjb2xsZWN0ZWRUYXJnZXRzID0gdGFyZ2V0c1xuICB9XG5cbiAgcG9pbnRlckV2ZW50cy5zaWduYWxzLm9uKCdjb2xsZWN0LXRhcmdldHMnLCBvbkNvbGxlY3QpXG4gIHBvaW50ZXJFdmVudHMuY29sbGVjdEV2ZW50VGFyZ2V0cyh7XG4gICAgaW50ZXJhY3Rpb246IG5ldyBJbnRlcmFjdGlvbih7IHNpZ25hbHM6IGhlbHBlcnMubW9ja1NpZ25hbHMoKSB9IGFzIGFueSksXG4gICAgcG9pbnRlcjoge30sXG4gICAgZXZlbnQ6IHt9LFxuICAgIGV2ZW50VGFyZ2V0OiB7fSxcbiAgICB0eXBlLFxuICB9IGFzIGFueSlcblxuICB0LmRlZXBFcXVhbChjb2xsZWN0ZWRUYXJnZXRzLCBbdGFyZ2V0XSlcblxuICBwb2ludGVyRXZlbnRzLnNpZ25hbHMub2ZmKCdjb2xsZWN0LXRhcmdldHMnLCBvbkNvbGxlY3QpXG5cbiAgdC5lbmQoKVxufSlcblxudGVzdCgncG9pbnRlckV2ZW50cyBJbnRlcmFjdGlvbiB1cGRhdGUtcG9pbnRlciBzaWduYWwnLCB0ID0+IHtcbiAgY29uc3Qgc2NvcGUgPSBoZWxwZXJzLm1vY2tTY29wZSgpXG5cbiAgaW50ZXJhY3Rpb25zLmluc3RhbGwoc2NvcGUpXG4gIHBvaW50ZXJFdmVudHMuaW5zdGFsbChzY29wZSlcblxuICBjb25zdCBpbnRlcmFjdGlvbiA9IHNjb3BlLmludGVyYWN0aW9ucy5uZXcoe30pXG4gIGNvbnN0IGluaXRpYWxIb2xkID0geyBkdXJhdGlvbjogSW5maW5pdHksIHRpbWVvdXQ6IG51bGwgfVxuICBjb25zdCBldmVudCA9IHt9IGFzIEludGVyYWN0LlBvaW50ZXJFdmVudFR5cGVcblxuICBpbnRlcmFjdGlvbi51cGRhdGVQb2ludGVyKGhlbHBlcnMubmV3UG9pbnRlcigwKSwgZXZlbnQsIG51bGwsIGZhbHNlKVxuICB0LmRlZXBFcXVhbChpbnRlcmFjdGlvbi5wb2ludGVycy5tYXAocCA9PiBwLmhvbGQpLCBbaW5pdGlhbEhvbGRdLCAnc2V0IGhvbGQgaW5mbyBmb3IgbW92ZSBvbiBuZXcgcG9pbnRlcicpXG5cbiAgaW50ZXJhY3Rpb24ucmVtb3ZlUG9pbnRlcihoZWxwZXJzLm5ld1BvaW50ZXIoMCksIGV2ZW50KVxuXG4gIGludGVyYWN0aW9uLnVwZGF0ZVBvaW50ZXIoaGVscGVycy5uZXdQb2ludGVyKDApLCBldmVudCwgbnVsbCwgdHJ1ZSlcbiAgdC5kZWVwRXF1YWwoaW50ZXJhY3Rpb24ucG9pbnRlcnMubWFwKHAgPT4gcC5ob2xkKSwgW2luaXRpYWxIb2xkXSlcblxuICBpbnRlcmFjdGlvbi51cGRhdGVQb2ludGVyKGhlbHBlcnMubmV3UG9pbnRlcig1KSwgZXZlbnQsIG51bGwsIHRydWUpXG4gIHQuZGVlcEVxdWFsKGludGVyYWN0aW9uLnBvaW50ZXJzLm1hcChwID0+IHAuaG9sZCksIFtpbml0aWFsSG9sZCwgaW5pdGlhbEhvbGRdKVxuXG4gIHQuZW5kKClcbn0pXG5cbnRlc3QoJ3BvaW50ZXJFdmVudHMgSW50ZXJhY3Rpb24gcmVtb3ZlLXBvaW50ZXIgc2lnbmFsJywgdCA9PiB7XG4gIGNvbnN0IHNjb3BlID0gaGVscGVycy5tb2NrU2NvcGUoKVxuXG4gIGludGVyYWN0aW9ucy5pbnN0YWxsKHNjb3BlKVxuICBwb2ludGVyRXZlbnRzLmluc3RhbGwoc2NvcGUpXG5cbiAgY29uc3QgaW50ZXJhY3Rpb24gPSBzY29wZS5pbnRlcmFjdGlvbnMubmV3KHt9KVxuXG4gIGNvbnN0IGlkcyA9IFswLCAxLCAyLCAzXVxuICBjb25zdCByZW1vdmFscyA9IFtcbiAgICB7IGlkOiAwLCByZW1haW46IFsxLCAyLCAzXSwgbWVzc2FnZTogJ2ZpcnN0IG9mIDQnICB9LFxuICAgIHsgaWQ6IDIsIHJlbWFpbjogWzEsICAgIDNdLCBtZXNzYWdlOiAnbWlkZGxlIG9mIDMnIH0sXG4gICAgeyBpZDogMywgcmVtYWluOiBbMSAgICAgIF0sIG1lc3NhZ2U6ICdsYXN0IG9mIDInICAgfSxcbiAgICB7IGlkOiAxLCByZW1haW46IFsgICAgICAgXSwgbWVzc2FnZTogJ2ZpbmFsJyAgICAgICB9LFxuICBdXG5cbiAgZm9yIChjb25zdCBpZCBvZiBpZHMpIHtcbiAgICBjb25zdCBpbmRleCA9IGludGVyYWN0aW9uLnVwZGF0ZVBvaW50ZXIoeyBwb2ludGVySWQ6IGlkIH0gYXMgSW50ZXJhY3QuUG9pbnRlclR5cGUsIHt9IGFzIEludGVyYWN0LlBvaW50ZXJFdmVudFR5cGUsIG51bGwsIHRydWUpXG4gICAgLy8gdXNlIHRoZSBpZHMgYXMgdGhlIHBvaW50ZXJJbmZvLmhvbGQgdmFsdWUgZm9yIHRoaXMgdGVzdFxuICAgIGludGVyYWN0aW9uLnBvaW50ZXJzW2luZGV4XS5ob2xkID0gaWQgYXMgYW55XG4gIH1cblxuICBmb3IgKGNvbnN0IHJlbW92YWwgb2YgcmVtb3ZhbHMpIHtcbiAgICBpbnRlcmFjdGlvbi5yZW1vdmVQb2ludGVyKHsgcG9pbnRlcklkOiByZW1vdmFsLmlkIH0gYXMgYW55LCBudWxsKVxuXG4gICAgdC5kZWVwRXF1YWwoaW50ZXJhY3Rpb24ucG9pbnRlcnMubWFwKHAgPT4gcC5ob2xkKSwgcmVtb3ZhbC5yZW1haW4sXG4gICAgICBgJHtyZW1vdmFsLm1lc3NhZ2V9IC0gcmVtYWluaW5nIGludGVyYWN0aW9uLmhvbGRUaW1lcnMgaXMgY29ycmVjdGApXG4gIH1cblxuICB0LmVuZCgpXG59KVxuIl19